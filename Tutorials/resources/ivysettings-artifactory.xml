<?xml version="1.0" encoding="UTF-8"?>
<ivy-settings>
  
  <property name="Artifactory_Repository" value="http://localhost:8081/artifactory" override="false"/>
  <property name="personalBuilds.dir" value="${user.home}/.ivy2/repository/" override="false"/>
  
  <!-- Map MMM resolvers (*.resolver) to custom resolver (publish*) -->
  <property name="release.resolver" value="publishRelease" override="false"/>
  <property name="shared.resolver" value="publishSnapshot" override="false"/>
  <property name="local.resolver" value="publishPersonal" override="false"/>
 
  <property name="artifacts.resolver" value="fetchRelease" override="false" /> <!-- Fetch the artifact only from release repositories -->
  <property name="request.cache.dir" value="${user.home}/.ivy2/cache" override="false"/><!-- default cache dir -->
  <property name="default.conflict.manager" value="latest-compatible" override="false"/>
  
  <settings defaultResolver="${artifacts.resolver}" defaultConflictManager="${default.conflict.manager}" defaultResolveMode="dynamic"/>
  <caches defaultCacheDir="${request.cache.dir}"/>	<!-- override the default cache directory -->
  <resolvers>

	<!--
		Types of resolver:
		- fetch resolvers: used to fetch artifacts from several repositories.
		- publish resolvers: used to publish artifacts into a repository.
		
		Kinds of repositories:
		- release: used when releasing a module.
		- snapshot: used when building a module snapshot.
		- personal: used when building a module in local or with a personal build.
	
	-->
	 
	<!-- Publish resolver in release: publish in release repository -->
	<url name="publishRelease" m2compatible="true">
		<artifact pattern="${Artifactory_Repository}/libs-release-local/[organization]/[module]/[branch]/[revision]/[artifact]-[revision](-[classifier]).[ext]" />
		<ivy pattern="${Artifactory_Repository}/libs-release-local/[organization]/[module]/[branch]/[revision]/ivy-[revision].xml" />
	</url>
	
	<!-- Publish resolver in snapshot: publish in snapshot repository -->
	<url name="publishSnapshot" m2compatible="true" checkmodified="true">
		<artifact pattern="${Artifactory_Repository}/libs-snapshot-local/[organization]/[module]/[branch]/[revision]/[artifact]-[revision](-[classifier]).[ext]" />
		<ivy pattern="${Artifactory_Repository}/libs-snapshot-local/[organization]/[module]/[branch]/[revision]/ivy-[revision].xml" />
	</url>
	
	<!-- Publish resolver in personal build: publish in personal repository -->
	<filesystem name="publishPersonal" m2compatible="true" checkmodified="true">
		<artifact pattern="${personalBuilds.dir}/[organization]/[module]/[branch]/[revision]/[artifact]-[revision](-[classifier]).[ext]" />
		<ivy pattern="${personalBuilds.dir}/[organization]/[module]/[branch]/[revision]/ivy-[revision].xml" />
	</filesystem>

	<url name="fetchMicroEJModules" m2compatible="true">
		<artifact pattern="${Artifactory_Repository}/microej-module-repository/[organization]/[module]/[branch]/[revision]/[artifact]-[revision](-[classifier]).[ext]" />
		<ivy pattern="${Artifactory_Repository}/microej-module-repository/[organization]/[module]/[branch]/[revision]/ivy-[revision].xml" />
	</url>

	<!-- Fetch resolver in release: look in release repositories -->
	<url name="fetchArtifactoryRelease" m2compatible="true" >
		<artifact pattern="${Artifactory_Repository}/libs-release/[organization]/[module]/[branch]/[revision]/[artifact]-[revision](-[classifier]).[ext]" />
		<ivy pattern="${Artifactory_Repository}/libs-release/[organization]/[module]/[branch]/[revision]/ivy-[revision].xml" />
	</url>
	
	<chain name="fetchRelease">
		<resolver ref="fetchMicroEJModules"/>
		<resolver ref="fetchArtifactoryRelease"/>
	</chain>
	
	<chain name="fetchSnapshot">
		<resolver ref="publishSnapshot"/>
		<resolver ref="fetchRelease"/>
	</chain>

	<!-- Fetch resolver for personal build: look in personal, snapshot and release repositories -->
	<chain name="fetchPersonal">
		<resolver ref="publishPersonal"/> 
		<resolver ref="fetchSnapshot"/> 
	</chain>
	
  </resolvers>
</ivy-settings>
