
========
Overview
========

Principle
=========

The notion of MicroUI Font gathers two distinct kinds of fonts:

1. The internal font format: a simple and small bitmap format (EJF), accessible in the application by calling `Font.getFont(String)`_.
2. The *custom* (or *extended*) font format: available in MicroUI extended libraries (such as MicroVG's `VectorFont`_), accessible in the application thanks a sub class of MicroUI `Font`_ class.

.. _section_font_core_process:

Functional Description
======================

The Font Engine consists in the font pre-generation (if required), the font loading at runtime and font rendering. 
The two first steps (generation and loading) are specific of the font kind (internal or custom), whereas the way to render a MicroUI Font (from the MicroUI API to the MicroUI Abstraction Layer API) is shared. 
This allows the application the use same MicroUI APIs with any kinds of fonts.

Internal Font
-------------

.. figure:: images/font-process2.*
   :alt: Font Generation
   :width: 800px
   :align: center

   Font Generation


The internal Font Engine is composed of:

* The :ref:`section.tool.fontdesigner` module: a graphical tool which runs within the MicroEJ IDE used to build and edit MicroUI fonts; it stores fonts in a VEE Port-independent format.
* The :ref:`section_fontgen` module, for converting fonts from the VEE Port-independent format into a VEE Port-dependent format.
* The :ref:`section_font_loader` module which reads the VEE Port-dependent fonts files generated by the "Font Generator".

The three modules are complementary: a MicroUI font must be created and edited with the Font Designer before being integrated as a resource by the Font Generator and loaded by the Font Loader at runtime.

Process overview:

1. User uses the Font Designer module to create a new font, and imports
   characters from system fonts (``*.ttf`` files) and / or user images
   (``*.png``, ``*.jpg``, ``*.bmp``, etc.).

2. Font Designer module saves the font as a MicroEJ Font (``*.ejf``
   file).

3. The user defines, in a text file, the fonts to load.

4. The Font Generator outputs a raw file for each font to convert (the
   raw format is display device-dependent).

5. The raw files are embedded as (hidden) resources within the application. The raw files' data are linked into the FLASH memory.

6. When the application creates a MicroUI Font object
   which targets a pre-generated font, the Font Engine Core only has to
   link from the MicroUI Font object to the data in the FLASH
   memory. Therefore, the loading is very fast; only the font data from
   the FLASH memory is used: no copy of the font data is sent to RAM
   memory first.

Custom Font
-----------

.. 
   XXX_TODO
   ttf
      | custom loader

The font engine for the custom fonts is specific to the font itself, see :ref:`section_font_custom`.

Dependencies
============

-  MicroUI module (see :ref:`section_microui`),
-  Display module (see :ref:`section_display`).

.. _Font.getFont(String): https://repository.microej.com/javadoc/microej_5.x/apis/ej/microui/display/Font.html#getFont-java.lang.String-
.. _Font: https://repository.microej.com/javadoc/microej_5.x/apis/ej/microui/display/Font.html#
.. _VectorFont: https://repository.microej.com/javadoc/microej_5.x/apis/ej/microvg/VectorFont.html#

..
   | Copyright 2008-2024, MicroEJ Corp. Content in this space is free 
   for read and redistribute. Except if otherwise stated, modification 
   is subject to MicroEJ Corp prior approval.
   | MicroEJ is a trademark of MicroEJ Corp. All other trademarks and 
   copyrights are the property of their respective owners.
